<script>
    var req_field = "Required field"
    var err_style = "color: rgb(255,75,75);"

    function submitform(a, b) {
        return fetch(window.location.origin + "/login", {
            method: "POST",
            body: new URLSearchParams({
                user: a,
                pass: b
            })
        })
    }

    async function updatevalid() {
        let userlabel = document.getElementById("userlabel")
        let pwordlabel = document.getElementById("pwordlabel")

        let usernamefield = document.getElementById("usernamefield")
        let pwordfield = document.getElementById("pwordfield")

        var res = await submitform(usernamefield.value, pwordfield.value)
        var body = await res.json()

        var username_valid = body.user
        var pword_valid = body.pass

        if (usernamefield.value) {
            if (!res.ok && !username_valid) {
                userlabel.style = err_style
                userlabel.innerText = "Invalid username"
            } else {
                userlabel.style = "color: whitesmoke;"
                userlabel.innerText = "Username"
            };
        } else {
            userlabel.style = err_style
            userlabel.innerText = req_field
        };

        if (pwordfield.value) {
            if (!res.ok && pword_valid == false) {
                pwordlabel.style = err_style
                pwordlabel.innerText = "Invalid Password"
            } else {
                pwordlabel.style = "color: whitesmoke;"
                pwordlabel.innerText = "Password"
            };
        } else {
            pwordlabel.style = err_style
            pwordlabel.innerText = req_field
        };

    }
</script>
<div class="middlebox" style="max-width: 500px; padding-top: 100px;">
    <h1>Log In</h1>

    <div class="textform">
        <a id="userlabel">Username</a>
        <br>
        <input type="text" name="username" id="usernamefield" required>
    </div>

    <br>

    <div class="textform">
        <a id="pwordlabel">Password</a>
        <br>
        <input type="password" name="password" id="pwordfield" required>
    </div>

    <br>
    <button onclick=updatevalid() id="submit" value="Submit" style="margin-bottom: 10px; padding: 8px 15px 8px 15px;">
        Submit
    </button>
    <br>
    <a>Need an account? </a><a href="/signup/">Sign up.</a>
</div>