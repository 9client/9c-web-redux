<script>
    var taken_names = {
        "9client": true,
    }

    var req_field = "Required field"
    var err_style = "color: rgb(255,75,75);"

    async function submitform(a, b) {
        return await fetch(window.location.origin + "/signup", {
            method: "POST",
            body: new URLSearchParams({
                user: a,
                pass: b
            })
        })
    }

    function updatevalid() {
        const userlabel = document.getElementById("userlabel")
        const pwordlabel = document.getElementById("pwordlabel")
        const vpwordlabel = document.getElementById("vpwordlabel")

        const usernamefield = document.getElementById("usernamefield")
        const pwordfield = document.getElementById("pwordfield")
        const vpwordfield = document.getElementById("vpwordfield")

        var res = submitform(usernamefield.value, pwordfield.value)

        var {
            user: username_valid,
            taken: username_taken,
            pass: pword_valid
        } = await res.json()
        var vpword_valid = vpwordfield.value == pwordfield.value

        if (usernamefield.value) {
            if (!ok) {
                userlabel.style = err_style
                if (username_taken) {
                    userlabel.innerText = "Username is taken"
                } else {
                    if (usernamefield.value.length > 3) {
                        if (usernamefield.value.length >= 20) {
                            userlabel.style = err_style
                            userlabel.innerText = "Username must be at most 20 characters"
                        };
                    } else {
                        userlabel.style = err_style
                        userlabel.innerText = "Username must be at least 3 characters"
                    };
                };
            } else {
                userlabel.style = "color: whitesmoke;"
                userlabel.innerText = "Username"
            };

            if (pwordfield.value) {
                if (!pword_valid && pwordfield.value.length < 8) {
                    pwordlabel.style = err_style
                    pwordlabel.innerText = "Password must be at least 8 characters"
                } else {
                    pwordlabel.style = "color: whitesmoke;"
                    pwordlabel.innerText = "Password"
                };
            } else {
                pwordlabel.style = err_style
                pwordlabel.innerText = req_field
            };

            if (vpwordfield.value) {
                if (vpword_valid) {
                    vpwordlabel.style = "color: whitesmoke;"
                    vpwordlabel.innerText = "Verify Password"
                } else {
                    vpwordlabel.style = err_style
                    vpwordlabel.innerText = "Must match password"
                };
            } else {
                vpwordlabel.style = err_style
                vpwordlabel.innerText = req_field

            };

        }
    }
</script>

    <div class="middlebox" style="max-width: 500px; padding-top: 100px;">
        <h1>Create an account</h1>

        <div class="textform">
            <a id="userlabel">Username</a>
            <br>
            <input type="text" name="username" id="usernamefield" required>
        </div>

        <br>

        <div class="textform">
            <a id="pwordlabel">Password</a>
            <br>
            <input type="password" name="password" id="pwordfield" required>
        </div>

        <br>

        <div class="textform">
            <a id="vpwordlabel">Verify Password</a>
            <br>
            <input type="password" name="vpassword" id="vpwordfield" required>
        </div>

        <br>
        <button onclick=updatevalid() id="submit" value="Submit" style="margin-bottom: 10px; padding: 8px 15px 8px 15px;">
            Submit
        </button>
        <br>
        <a>Have an account? </a><a href="/login">Log in.</a>
    </div>